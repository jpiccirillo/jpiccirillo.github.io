<!DOCTYPE html>
<html>

<head>
    <title>Normal Plot</title>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>
    <style type="text/css">
        body,
        html {
            width: 1000px;
            height: 1000px;
            /*padding: 10px;*/
            margin: 0;
        }

        svg {
            max-width: 2000px;
            /*max-height;*/
            /*display: block;*/
            margin: auto;
            position: absolute;
            top: 0;
            /*bottom: 100px;*/
            left: 300px;
            right: 0;
        }

        svg path {
            /*bottom:100px;*/
            /*padding: 0px;*/
            /*fill: lightblue;*/
            stroke: grey;
            cursor: move;
            /*stroke-width: 2px;*/
            /*position: absolute;*/
        }
    </style>
</head>

<body>
    <FORM><pre>
              Mean0: <INPUT TYPE="text" NAME="mean0" id="mean0" Value="0"></INPUT>
              Mean1: <INPUT TYPE="text" NAME="mean1" id="mean1" Value="10"></INPUT>
Standard Deviation: <INPUT TYPE="text" NAME="stdev" Value="6"></INPUT>
        SampleSize: <INPUT TYPE="text" NAME="ssize" Value="5"></INPUT>

<BR>
Normal Probability: <INPUT TYPE="text" NAME="result" SIZE=20></INPUT>
                    <INPUT TYPE="button" VALUE="Calculate" ONCLICK="prepare(this.form)"></INPUT>
                    </pre>
    </FORM>
    <!-- <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" id="svg"> -->
    <!-- </svg> -->
</body>

<script type="text/javascript">

    function remap(inputArray, newMin, newMax, orientation) {
        if (orientation == "x") {
            oldMin = inputArray[0][0]
            oldMax = inputArray[inputArray.length - 1][0]

            for (i = 0; i < inputArray.length; i++) {
                inputArray[i][0] = remapValue(inputArray[i][0], oldMin, oldMax, newMin, newMax)
            }
        }
    }

    function remapValue(value, low1, high1, low2, high2) {
        return low2 + (value - low1) * (high2 - low2) / (high1 - low1)
    }

    function normalpdf(x, mu0, std) { //HASTINGS.  MAX ERROR = .000001
        return (Math.exp(-0.5 * Math.log(2 * Math.PI) - Math.log(std) - Math.pow(x - mu0, 2) / (2 * std * std))).toFixed(7);
    }

    function maxHeight(std, mu0) {
        //Take std and calculate max height of page (std / sqrt(99)), save to var = maxHeight;
        std_n = std / (Math.sqrt(100))
        return normalpdf(mu0, mu0, std_n) * 1.2
    }

    function prepare(form) {
        mu0 = eval(form.mean0.value)
        mu1 = eval(form.mean1.value)
        std = eval(form.stdev.value)
        n = eval(form.ssize.value);
        std_n = std / Math.sqrt(n)

        // console.log("standarddev/(sqrt(n)", std_n)
        step = 8 * std / 100
        windowHeight = maxHeight(std, mu0);
        console.log(windowHeight)

        firsthalf = [];
        i = 0;
        for (var x = mu0 - 4 * std; x < mu0 + 4 * std; x += step) {
            firsthalf[i] = {
                x: x * 20,
                y: normalpdf(x, mu0, std / (Math.sqrt(n))) * 400
            };
            i++;
        }
        console.log("calculation completed")

        secondhalf = [];
        i = 0;
        for (var x = mu1 - 4 * std; x < mu1 + 4 * std; x += step) {
            secondhalf[i] = {
                x: x * 20,
                y: normalpdf(x, mu1, std / (Math.sqrt(n))) * 400
            };
            i++;
        }
        console.log("calculation completed")

        var dist1 = d3.svg.line()
            .x(function(d) {
                return d.x;
            })
            .y(function(d) {
                return d.y;
            })
            .interpolate("cardinal");

        var dist2 = d3.svg.line()
            .x(function(d) {
                return d.x;
            })
            .y(function(d) {
                return d.y;
            })
            .interpolate("cardinal");

        var drag = d3.behavior.drag()
            .on("drag", function(d, i) {
                d.x += d3.event.dx
                d3.select(this).attr("transform", function(d, i) {
                    return "translate(" + [d.x, 0] + ")"
                })
                if (d3.select(this).attr("fill") == "pink") {
                    $("#mean1").val(d.x)
                } else {
                    $("#mean0").val(d.x)
                }
            });

        //The SVG Container
        var svgContainer = d3.select("body").append("svg")
            .attr("width", 600)
            .attr("height", 400);

        $("path").remove()
        var plot1 = svgContainer.append("path")
            .data([{
                "x": 0,
                "y": 0
            }])
            .attr("fill", "lightblue")
            .attr("stroke-width", 2)
            .attr("d", dist1(firsthalf))
            .call(drag);

        var plot2 = svgContainer.append("path")
            .data([{
                "x": 10,
                "y": 30
            }])
            .attr("fill", "pink")
            .attr("stroke-width", 2)
            .attr("d", dist2(secondhalf))
            .call(drag);
    }
</script>

</html>
