<!DOCTYPE html>
<html>

<head>

	<title>Layers Control Tutorial - Leaflet</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
	<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />

	<style>
		:root {
			--grey1: #2f4f4f;
			--grey2: #304755;
			--grey3: #2f3e5b;
			--grey4: #2d3660;
			--grey5: #292c65;
			--grey6: #23236b;
			--grey7: #191970;
		}

		html,
		body {
			height: 100%;
			margin: 0;
		}

		#map {
			width: 100%;
			height: 100%;
		}

		#stl {
			position: relative;
			top: .5in;
			left: .5in;
			width: 3.75in;
			height: 5in;
			/*background-color: white;*/
		}

		#printPage {
			margin: 0px;
			padding: 0px;
			width: 8.5in;
			/* width: 7in; */
			height: 11in;
			/* or height: 9.5in; */
			clear: both;
			background-color: gray;
			page-break-after: always;
		}

		.leaflet-tooltip-pane .text {
			color: var(--grey3);
			font-family: "Tahoma";
			/*font-weight: bold;*/
			background: transparent;
			border: 0;
			box-shadow: none;
			font-size: .85em;
		}
	</style>


</head>

<body>
<div id="printPage">
	<div id="stl">
		<div id='map'></div>
	</div>
	<!-- <div id="stl2">
		<div id='map2'></div>
	</div> -->
</div>

	<script>
		var cities = L.layerGroup();
		// L.circle([50.5, 30.5], {radius: 200}).addTo(map);
		// L.circle([39.61, -105.02], {radius: 800, weight:1.5 }).bindPopup('This is Littleton, CO.').addTo(cities),
		// L.marker([39.74, -104.99]).bindPopup('This is Denver, CO.').addTo(cities),
		// L.marker([39.73, -104.8]).bindPopup('This is Aurora, CO.').addTo(cities),
		// L.marker([39.77, -105.23]).bindPopup('This is Golden, CO.').addTo(cities);

		var buildingPoints = [{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99],
				},
				"properties": {
					"text": "5",
					"radius": 1200
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99],
				},
				"properties": {
					"text": "5",
					"radius": 1200
				}
			}
		];

		var buildingPoints2 = [
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Washington University",
					"streetaddress": "660 S Euclid Ave, St. Louis MO 63110",
					"secondary": "",
					"citystatezip": "St. Louis, MO"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Maryland Medical Group",
					"streetaddress": "1110 Highlands Plaza Drive",
					"secondary": "#375",
					"citystatezip": "St. Louis, MO 63110"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Grant Medical Group",
					"streetaddress": "114 N Taylor Avenue",
					"secondary": "",
					"citystatezip": "St. Louis, MO 63108"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Washington University Complete Care",
					"streetaddress": "1040 N. Mason Rd",
					"secondary": "Suite 103",
					"citystatezip": "Creve Coeur, MO 63141"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Alton Internal Medicine",
					"streetaddress": "2 Memorial Drive",
					"secondary": "#220",
					"citystatezip": "Alton, IL 62002"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Associated Internists",
					"streetaddress": "3009 North Ballas Road",
					"secondary": "Building A, Suite 227",
					"citystatezip": "St. Louis, MO"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Barnes St. Peters Internal Medicine",
					"streetaddress": "201 BJC St. Peters Drive",
					"secondary": "Suite 200",
					"citystatezip": "Saint Peters, MO 63376"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Central Medical Group",
					"streetaddress": "4921 Parkview Place",
					"secondary": "Suite 14A",
					"citystatezip": "Saint Louis, MO 63110"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Family Physicians of Alton",
					"streetaddress": "4 Memorial Drive",
					"secondary": "",
					"citystatezip": "Alton, IL 62002"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Family Physicians of Bethalto",
					"streetaddress": "155 East Bethalto Drive",
					"secondary": "",
					"citystatezip": "Bethalto, IL 62010"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Hazelwood",
					"streetaddress": "7451 A North Lindbergh Boulevard",
					"secondary": "",
					"citystatezip": "Hazelwood, Missouri 63042"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Highlands",
					"streetaddress": "1110 Highlands Plaza Drive",
					"secondary": "#280",
					"citystatezip": "St. Louis, MO 63110"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Internal Medicine Specialists",
					"streetaddress": "3009 North Ballas Road",
					"secondary": "Building C, Suite 387",
					"citystatezip": "Saint Louis, MO 63131"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Medical Arts Clinic",
					"streetaddress": "1103 West Liberty Street",
					"secondary": "",
					"citystatezip": "Farmington, MO 63640"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Northwest HealthCare",
					"streetaddress": "1225 Graham Road",
					"secondary": "Building C, 2nd Floor, Suite 2320C",
					"citystatezip": "Florissant, MO 63031"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Overland Medical Group",
					"streetaddress": "8888 Ladue Road",
					"secondary": "Suite 210",
					"citystatezip": "St. Louis, MO 63124"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Progress West (Primary Care)",
					"streetaddress": "20 Progress Point Parkway",
					"secondary": "Building 1, Suite 108",
					"citystatezip": "O'Fallon, MO 63368"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "St. Peters",
					"streetaddress": "201 BJC St. Peters Drive",
					"secondary": "Suite 200",
					"citystatezip": "Saint Peters, MO 63376"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Sullivan Clinic",
					"streetaddress": "965 Mattox Drive",
					"secondary": "Suite Building A",
					"citystatezip": "Sullivan, MO 63080"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Sunset Hills Adult Medicine",
					"streetaddress": "3844 South Lindbergh Boulevard",
					"secondary": "Suite 120",
					"citystatezip": "Saint Louis, MO 63127"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "UCSD",
					"streetaddress": "9500 Gilman Drive",
					"secondary": "",
					"citystatezip": "La Jolla, CA 92093"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Hillcrest",
					"streetaddress": "330 Lewis Street (at Fourth)",
					"secondary": "",
					"citystatezip": "San Diego, CA 92103"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "La Jolla",
					"streetaddress": "9333 Genesee Avenue",
					"secondary": "",
					"citystatezip": "San Diego, CA 92121"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Scripps Ranch",
					"streetaddress": "9909 Mira Mesa Blvd.",
					"secondary": "Suite 200",
					"citystatezip": "San Diego, CA 92131"
				}
			},
			{
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [39.73, -104.99]
				},
				"property": {
					"text": "50",
					"radius": 1200
				},
				"address": {
					"name": "Center For Mindfulness (CFM)",
					"streetaddress": "5060 Shoreham Place",
					"secondary": "#330",
					"citystatezip": "San Diego, CA 92122"
				}
			}
		]

		// var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
		// 		'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
		// 		'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		var mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

		var grayscale = L.tileLayer(mbUrl, {
			id: 'mapbox.light'
		})
		streets = L.tileLayer(mbUrl, {
			id: 'mapbox.streets'
		});

		var map = L.map('map', {
			center: [38.705959045854854, -90.37911482155326],
			zoom: 10,
			layers: [grayscale, cities]
		});
		// var map2 = L.map('map2', {
		// 	center: [38.51706659003426, -90.33719650469722],
		// 	zoom: 10,
		// 	layers: [grayscale, cities]
		// });

		var baseLayers = {
			"Grayscale": grayscale,
			"Streets": streets
		};

		var overlays = {
			"Cities": cities
		};
		// console.log(map.getCenter())

		// Make API call and return response
		function Get(yourUrl) {
			var Httpreq = new XMLHttpRequest(); // a new request
			Httpreq.open("GET", yourUrl, false);
			Httpreq.send(null);
			return Httpreq.responseText;
		}
		// Convert API response to json, return geometry object {lat, lng}
		function parseLatLon(json) {
			json = JSON.parse(json)
			// console.log(json)
			return json.results[0].geometry.location;
		}

		function getLatLon(address, citystatezip) {

			// console.log(address)
			// var apiKEY = "AIzaSyBRx7Cu0K1yT5nS9qZFiSbRaQZpPxz_9wk"
			// AIzaSyDRKSTrmFlDIvGaUPJeHW7DG6hBzhZK6jc
			// AIzaSyBoBscaL-pwNzwrEgvK1vTJSBAGkdQT3ds
			var addressFormatted = address + ",+" + citystatezip
			var apiKEY = "AIzaSyBRx7Cu0K1yT5nS9qZFiSbRaQZpPxz_9wk"
			var call = "https://maps.googleapis.com/maps/api/geocode/json?address=" + addressFormatted + "&key=" + apiKEY
			// console.log(call)
			var json = Get(call);
			// console.log(json);
			var latlon = parseLatLon(json);
			// console.log("coordinates=[" + latlon.lat + ", " + latlon.lng + "]")
			return latlon;
		}

		L.control.layers(baseLayers, overlays).addTo(map);
		var counter = 0;
		var Classroomsamount = new L.geoJson(buildingPoints2, {
			pointToLayer: function(feature, latlng) {
				// var address = feature.address.streetaddress.replace(/ /g, "+")
				var address = feature.address.streetaddress.replace(/ /g, "+")
				var citystatezip = feature.address.citystatezip.replace(/ /g, "+")

				var latlng = getLatLon(address, citystatezip)

				// addressFormatted = "".join([address, ",+", citystatezip])
				// apiKEY = "AIzaSyBRx7Cu0K1yT5nS9qZFiSbRaQZpPxz_9wk"
				// call = "".join(["https://maps.googleapis.com/maps/api/geocode/json?address=", addressFormatted, "&key=", apiKEY])
				//
				// var xhttp = new XMLHttpRequest();
				// xhttp.open("GET", "demo_get.asp", true);
				// xhttp.send();
				//
				// "address": {
				// 	"name": "Center For Mindfulness (CFM)",
				// 	"streetaddress": "5060 Shoreham Place",
				// 	"secondary": "#330",
				// 	"citystatezip": "San Diego, CA 92122"
				// }
				// response = requests.get(call)
				// json_data = response.json()
				// console.log([latlng.lng, latlng.lat])
				// lat = str(json_data['results'][0]['geometry']['location']['lat'])
				// lon = str(json_data['results'][0]['geometry']['location']['lng'])
				console.log(latlng.lat + "|" + latlng.lng + "|" + feature.address.name + "|" + feature.address.streetaddress + " " + feature.address.secondary + ", " + feature.address.citystatezip)
				return new L.Circle([latlng.lat, latlng.lng], {
					radius: feature.property.radius,
					weight: 1.5,
					fillColor: 'darkgrey',
					fillOpacity: 0.5,
					radius: 900,
					color: '#2f3e5b',
				}).addTo(cities)
			},
			onEachFeature: function(feature, layer) {
				counter++;
				var text = L.tooltip({
						permanent: true,
						direction: 'center',
						className: 'text'
					})
					.setContent(String(counter))
					.setLatLng(layer.getLatLng());
				text.addTo(map);


				// var text2 = L.tooltip({
				// 		direction: 'top',
				// 		className: 'text2'
				// 	})
				// 	.setContent(feature.properties.text)
				// 	.setLatLng(layer.getLatLng());
				// layer.bindTooltip(text2);
			}
		}).addTo(map);
	</script>



</body>

</html>
